<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stronger in 30 ‚Äî Beginner Board</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400;1,600&family=Syne:wght@400;500;600;700;800&family=DM+Mono:wght@300;400&display=swap" rel="stylesheet">
<style>
:root {
  --white: #ffffff;
  --off: #f7f6f3;
  --bg: #fafaf8;
  --ink: #1a1a1a;
  --ink-muted: #8a8a8a;
  --ink-light: #c8c8c8;
  --accent: #7c3aed;
  --accent-light: #f5f3ff;
  --accent-mid: #9333ea;
  --border: #e8e6e0;
  --border-strong: #d0cec8;
  --gold: #b8960c;
  --gold-bg: #fdf8e8;
  --purple-soft: #ede9fe;
  --week-colors: #7c3aed, #1a4d6e, #a05c2d, #6b3fa0, #c0392b;
  --radius: 10px;
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
  --shadow-md: 0 4px 16px rgba(0,0,0,0.07), 0 1px 4px rgba(0,0,0,0.04);
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background: var(--bg);
  color: var(--ink);
  font-family: 'Syne', sans-serif;
  -webkit-font-smoothing: antialiased;
  padding: 0;
}

/* ‚îÄ‚îÄ TOP HEADER BAND ‚îÄ‚îÄ */
.masthead {
  background: var(--white);
  border-bottom: 1px solid var(--border);
  padding: 36px 48px 28px;
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  gap: 24px;
}

.masthead-left {}

.studio-tag {
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 0.22em;
  text-transform: uppercase;
  color: var(--ink-muted);
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.studio-tag::before {
  content: '';
  display: inline-block;
  width: 18px;
  height: 1px;
  background: var(--ink-muted);
}

.title-group {
  display: flex;
  align-items: baseline;
  gap: 16px;
}

.main-title {
  font-family: 'Cormorant Garamond', serif;
  font-size: 56px;
  font-weight: 600;
  letter-spacing: -0.02em;
  line-height: 1;
  color: var(--ink);
}

.main-title em {
  font-style: italic;
  color: var(--accent);
}

.level-chip {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: var(--accent-light);
  color: var(--accent);
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  padding: 5px 12px;
  border-radius: 100px;
  border: 1px solid rgba(124,58,237,0.15);
  margin-bottom: 6px;
}

.masthead-right {
  text-align: right;
  flex-shrink: 0;
}

.date-range {
  font-size: 11px;
  font-weight: 500;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--ink-muted);
  margin-bottom: 6px;
}

.date-range strong {
  color: var(--ink);
  font-weight: 700;
}

.member-count {
  font-size: 28px;
  font-weight: 800;
  color: var(--ink);
  line-height: 1;
}

.member-count span {
  font-size: 11px;
  font-weight: 500;
  color: var(--ink-muted);
  letter-spacing: 0.1em;
  text-transform: uppercase;
  margin-left: 4px;
  vertical-align: middle;
}

/* ‚îÄ‚îÄ STICKER LEGEND ‚îÄ‚îÄ */
.sticker-legend {
  background: var(--white);
  border-bottom: 1px solid var(--border);
  padding: 14px 48px;
  display: flex;
  align-items: center;
  gap: 28px;
  overflow-x: auto;
}

.legend-label {
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: var(--ink-muted);
  white-space: nowrap;
  flex-shrink: 0;
}

.legend-items {
  display: flex;
  align-items: center;
  gap: 20px;
  flex-wrap: wrap;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 7px;
  font-size: 11px;
  font-weight: 500;
  color: var(--ink);
  white-space: nowrap;
}

.sticker-preview {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  border-radius: 8px;
  background: var(--off);
  border: 1px solid var(--border);
  flex-shrink: 0;
}

/* ‚îÄ‚îÄ CHALLENGE INFO ‚îÄ‚îÄ */
.challenge-info {
  background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
  border-bottom: 1px solid #e9e5f5;
  padding: 20px 48px;
}

.challenge-title {
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: #7c3aed;
  margin-bottom: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.challenge-title::before {
  content: 'üéØ';
  font-size: 14px;
}

.challenge-weeks {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
  margin-bottom: 12px;
}

.challenge-week {
  display: flex;
  flex-direction: column;
  gap: 5px;
  background: white;
  padding: 10px 14px;
  border-radius: 8px;
  border: 1px solid #e9e5f5;
  box-shadow: 0 1px 3px rgba(124,58,237,0.08);
  transition: all 0.18s ease;
}

.challenge-week:hover {
  border-color: #c4b5fd;
  box-shadow: 0 3px 10px rgba(124,58,237,0.15);
  transform: translateY(-1px);
}

.cw-label {
  font-size: 8px;
  font-weight: 700;
  letter-spacing: 0.16em;
  text-transform: uppercase;
  color: white;
  background: linear-gradient(135deg, #7c3aed 0%, #9333ea 100%);
  padding: 3px 9px;
  border-radius: 5px;
  display: inline-block;
  width: fit-content;
  box-shadow: 0 2px 4px rgba(124,58,237,0.25);
}

.cw-goal {
  font-size: 12px;
  font-weight: 600;
  font-family: 'DM Mono', monospace;
  color: var(--ink);
  line-height: 1.4;
  padding-left: 1px;
}

.challenge-note {
  font-size: 10px;
  font-weight: 500;
  color: #7c3aed;
  background: rgba(124,58,237,0.06);
  padding: 6px 12px;
  border-radius: 5px;
  display: inline-block;
  width: fit-content;
}

/* ‚îÄ‚îÄ MAIN TABLE AREA ‚îÄ‚îÄ */
.board-wrap {
  padding: 32px 48px 48px;
}

.table-scroll {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: 14px;
  box-shadow: var(--shadow-md);
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
  min-width: max-content;
  table-layout: fixed;
}

/* ‚îÄ‚îÄ WEEK GROUP HEADERS ‚îÄ‚îÄ */
th.week-h {
  background: linear-gradient(to bottom, var(--off) 0%, var(--white) 100%);
  border-bottom: 2px solid var(--border-strong);
  border-left: 2px solid var(--border-strong);
  padding: 0;
  text-align: center;
  vertical-align: middle;
}

th.week-h:first-of-type {
  border-left: none;
}

th.week-h.bonus-week {
  background: linear-gradient(to bottom, #fafafa 0%, var(--white) 100%);
}

th.week-h.bonus-week .week-tag {
  background: #888;
  font-size: 7px;
  padding: 3px 8px;
}

th.week-h.bonus-week .week-dates {
  color: #aaa;
}

.week-header-row th {
  padding: 0;
}

.week-group-header {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 3px;
  min-height: 44px;
  padding: 8px 6px;
}

.location-label-cell {
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  color: var(--accent);
  white-space: nowrap;
  vertical-align: middle;
}
.location-goal-cell {
  padding: 6px 2px !important;
  vertical-align: middle;
  text-align: center;
}
.loc-goal-wrap {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 3px;
  width: 100%;
}
.loc-span-arrow {
  font-size: 7px;
  color: var(--accent);
  opacity: 0.4;
  flex-shrink: 0;
  pointer-events: none;
  line-height: 1;
}
.loc-goal-badge {
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  gap: 0;
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: 20px;
  padding: 4px 12px;
  cursor: pointer;
  font-family: inherit;
  transition: border-radius 0.15s, padding 0.15s, box-shadow 0.15s;
  box-shadow: 0 1px 4px rgba(0,0,0,0.14);
  white-space: nowrap;
}
.loc-goal-badge:hover { filter: brightness(1.1); }
.loc-goal-badge.open {
  border-radius: 8px;
  padding: 7px 12px;
}
.loc-badge-label {
  font-size: 9px;
  font-weight: 800;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  pointer-events: none;
}
.loc-badge-detail {
  display: none;
  flex-direction: column;
  align-items: flex-start;
  gap: 5px;
  margin-top: 6px;
  width: 100%;
}
.loc-goal-badge.open .loc-badge-detail { display: flex; }
.loc-req-pill {
  display: flex;
  align-items: center;
  gap: 5px;
  white-space: nowrap;
  pointer-events: none;
}
.loc-req-count {
  font-style: normal;
  font-size: 10px;
  font-weight: 800;
  font-family: 'DM Mono', monospace;
  color: rgba(255,255,255,0.75);
  min-width: 16px;
  text-align: right;
}
.loc-req-icon { font-size: 13px; line-height: 1; }
.loc-req-name {
  font-size: 10px;
  font-weight: 600;
  color: #fff;
  letter-spacing: 0.01em;
}

.week-tag {
  font-size: 8px;
  font-weight: 700;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  color: white;
  background: var(--wk-color, #2d5a27);
  padding: 3px 10px;
  border-radius: 100px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  white-space: nowrap;
}

.week-dates {
  font-size: 8px;
  font-weight: 500;
  color: var(--ink-muted);
  letter-spacing: 0.06em;
  white-space: nowrap;
}

/* ‚îÄ‚îÄ COLUMN HEADERS ‚îÄ‚îÄ */
thead th {
  background: var(--white);
  border-bottom: 2px solid var(--border-strong);
  padding: 5px;
  font-weight: 600;
  vertical-align: bottom;
}

th.rank-h {
  width: 40px;
  min-width: 40px;
}

th.name-h {
  min-width: 175px;
  width: 175px;
  text-align: left;
  padding-left: 8px;
  padding-bottom: 10px;
}

th.name-h .col-label {
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: var(--ink-muted);
}

th.day-h {
  width: 42px;
  min-width: 42px;
  text-align: center;
  padding-bottom: 8px;
  position: relative;
}

th.day-h.weekend .day-num { color: var(--ink-light); }

.day-num {
  display: block;
  font-size: 12px;
  font-weight: 700;
  color: var(--ink);
  line-height: 1;
}

.day-name {
  display: block;
  font-size: 8px;
  font-weight: 500;
  color: var(--ink-muted);
  letter-spacing: 0.05em;
  margin-top: 2px;
}

th.score-h {
  width: 64px;
  min-width: 64px;
  text-align: center;
  padding-bottom: 10px;
}

th.score-h .col-label {
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: var(--ink-muted);
}

/* ‚îÄ‚îÄ DATA ROWS ‚îÄ‚îÄ */
tbody tr.data-row {
  border-bottom: 1px solid var(--border);
  transition: background 0.12s;
}

tbody tr.data-row:hover { background: #f9f9f7; }
tbody tr.data-row:last-of-type { border-bottom: none; }

/* rank */
td.rank-td {
  text-align: center;
  width: 40px;
  padding: 0 4px;
  vertical-align: middle;
}

.rank-inner {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  font-size: 11px;
  font-weight: 700;
  margin: 0 auto;
  color: var(--ink-muted);
  background: transparent;
}

.rank-inner.r1 {
  font-size: 18px;
}
.rank-inner.r2 {
  font-size: 18px;
}
.rank-inner.r3 {
  font-size: 18px;
}

/* name */
td.name-td {
  padding: 0 16px 0 8px;
  vertical-align: middle;
  height: 52px;
}

.member-name {
  font-size: 13.5px;
  font-weight: 600;
  color: var(--ink);
  line-height: 1.2;
}

.member-sub {
  font-size: 10px;
  color: var(--ink-muted);
  font-weight: 400;
  margin-top: 1px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.streak-flame {
  display: none;
  align-items: center;
  gap: 2px;
  font-size: 10px;
  font-weight: 700;
  color: #e55b2d;
}
.streak-flame.show { display: flex; }

/* sticker cell */
td.day-td {
  text-align: center;
  vertical-align: middle;
  width: 42px;
  height: 52px;
  padding: 0 2px;
  position: relative;
}

td.day-td.weekend { background: #fafafa; }

td.day-td.week-completed {
  background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
  position: relative;
}

td.day-td.week-completed.weekend {
  background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
}

/* The sticker slot */
.sticker-slot {
  width: 34px;
  height: 34px;
  margin: 0 auto;
  border-radius: 8px;
  border: 1.5px dashed var(--border-strong);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.15s ease;
  position: relative;
  font-size: 20px;
  background: transparent;
  user-select: none;
}

.sticker-slot:hover {
  border-color: var(--accent-mid);
  background: var(--accent-light);
  transform: scale(1.08);
}

.sticker-slot.has-sticker {
  border: none;
  background: var(--off);
  transform: none;
}

.sticker-slot.has-sticker:hover {
  background: #f0ede6;
  transform: scale(1.1) rotate(3deg);
}

/* Qualifying sticker highlight ‚Äî uses box-shadow so border:none on .has-sticker doesn't interfere */
.sticker-slot.has-sticker.qualifying {
  box-shadow: 0 0 0 1.5px rgba(124,58,237,0.45);
}
.sticker-slot.has-sticker.qualifying:hover {
  transform: scale(1.1) rotate(3deg);
}

/* Shared JS tooltip */
#cell-tooltip {
  display: none;
  position: fixed;
  z-index: 9999;
  background: var(--ink);
  color: #fff;
  font-family: 'Syne', sans-serif;
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 0.06em;
  white-space: nowrap;
  padding: 4px 9px;
  border-radius: 6px;
  pointer-events: none;
  box-shadow: 0 3px 10px rgba(0,0,0,0.22);
  transform: translateX(-50%);
}

/* Sticker picker popup */
.picker-popup {
  display: none;
  position: fixed;
  z-index: 1000;
  background: white;
  border: 1px solid var(--border-strong);
  border-radius: 12px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.14);
  padding: 10px;
  gap: 6px;
  flex-wrap: wrap;
  width: 186px;
}

.picker-popup.open {
  display: flex;
}

.picker-sticker {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  border-radius: 8px;
  cursor: pointer;
  border: 1.5px solid transparent;
  transition: all 0.12s;
  background: var(--off);
}

.picker-sticker:hover {
  border-color: var(--accent);
  background: var(--accent-light);
  transform: scale(1.18);
}

.picker-clear {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  font-weight: 700;
  color: #e55;
  border-radius: 8px;
  cursor: pointer;
  border: 1.5px dashed #e55;
  background: #fff5f5;
  transition: all 0.12s;
}
.picker-clear:hover { background: #ffe8e8; transform: scale(1.1); }

/* score */
td.score-td {
  text-align: center;
  vertical-align: middle;
  width: 64px;
  padding: 0 8px;
  position: relative;
}

.score-pill {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 36px;
  height: 24px;
  border-radius: 100px;
  font-size: 12px;
  font-weight: 700;
  font-family: 'DM Mono', monospace;
  color: var(--ink-muted);
  background: var(--off);
  cursor: help;
  position: relative;
}

.score-pill.lit {
  background: var(--accent-light);
  color: var(--accent);
}

.score-pill.maxed {
  background: linear-gradient(135deg, #fdf4ff 0%, #fae8ff 100%);
  color: #a855f7;
  border: 1px solid #e9d5ff;
}

.score-tooltip {
  display: none;
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  margin-bottom: 8px;
  background: var(--ink);
  color: white;
  padding: 12px 14px;
  border-radius: 10px;
  font-size: 10px;
  font-weight: 500;
  white-space: nowrap;
  z-index: 100;
  box-shadow: 0 8px 24px rgba(0,0,0,0.25);
}

.score-pill:hover .score-tooltip {
  display: block;
}

.score-tooltip::after {
  content: '';
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 6px solid transparent;
  border-top-color: var(--ink);
}

.weekly-status {
  display: flex;
  gap: 8px;
  align-items: center;
}

.week-badge {
  font-size: 9px;
  font-weight: 700;
  padding: 4px 8px;
  border-radius: 5px;
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.2);
  color: rgba(255,255,255,0.6);
  min-width: 42px;
  text-align: center;
}

.week-badge.complete {
  background: var(--accent-light);
  color: var(--accent);
  border-color: var(--accent);
  font-weight: 800;
}

/* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
.board-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 48px 40px;
  gap: 20px;
}

.footer-note {
  font-size: 10px;
  color: var(--ink-muted);
  letter-spacing: 0.08em;
}

.footer-logo {
  font-family: 'Cormorant Garamond', serif;
  font-size: 16px;
  font-style: italic;
  color: var(--ink-light);
  letter-spacing: 0.05em;
}

/* Scrollbar */
.table-scroll::-webkit-scrollbar { height: 4px; }
.table-scroll::-webkit-scrollbar-track { background: var(--off); }
.table-scroll::-webkit-scrollbar-thumb { background: var(--border-strong); border-radius: 2px; }

/* Responsive */
@media (max-width: 1200px) {
  .challenge-weeks {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 768px) {
  .challenge-weeks {
    grid-template-columns: 1fr;
  }

  .masthead {
    flex-direction: column;
    align-items: flex-start;
  }

  .masthead-right {
    text-align: left;
  }
}

/* Animate rows in */
tbody tr.data-row {
  animation: rowIn 0.35s ease both;
}

@keyframes rowIn {
  from { opacity: 0; transform: translateX(-8px); }
  to { opacity: 1; transform: translateX(0); }
}

/* ‚îÄ‚îÄ LOCATION GROUP SEPARATOR ‚îÄ‚îÄ */
tr.location-group-header { animation: none; }
td.location-header-cell {
  padding: 10px 18px 12px;
  background: var(--accent-light);
  border-top: 2px solid var(--border-strong);
  border-bottom: 1px solid var(--border-strong);
}
tr.location-group-header:first-child td.location-header-cell { border-top: none; }

/* ‚îÄ‚îÄ DATA STATUS & REFRESH BUTTON ‚îÄ‚îÄ */
.data-status {
  font-size: 9px;
  font-weight: 500;
  color: var(--ink-muted);
  letter-spacing: 0.06em;
  margin-top: 6px;
  min-height: 14px;
}
.refresh-btn {
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 0.06em;
  background: var(--off);
  border: 1px solid var(--border-strong);
  border-radius: 5px;
  padding: 3px 10px;
  cursor: pointer;
  color: var(--ink);
  margin-top: 4px;
  transition: background 0.15s;
  font-family: 'Syne', sans-serif;
}
.refresh-btn:hover { background: var(--border); }
.refresh-btn:disabled { opacity: 0.45; cursor: default; }
</style>
</head>
<body>
  <!-- Dynamic configuration loading -->
  <script>
    // Initialize default config first
    window.GOOGLE_SHEETS_CONFIG = {
      SPREADSHEET_ID: 'YOUR_SPREADSHEET_ID_HERE',
      SHEET_NAME: 'Checkins',
      CLIENT_ID: 'YOUR_CLIENT_ID_HERE',
      CLIENT_SECRET: 'YOUR_CLIENT_SECRET_HERE',
      REFRESH_TOKEN: 'YOUR_REFRESH_TOKEN_HERE'
    };
    
    // Try to load config.live.js if it exists (silent loading)
    const configScript = document.createElement('script');
    configScript.src = 'config.live.js';
    configScript.onerror = function() { 
      // Silent - no console messages to avoid 404 noise
    };
    configScript.onload = function() {
      console.log('‚úÖ Loaded custom configuration');
    };
    document.head.appendChild(configScript);
  </script>

<!-- STICKER PICKER (shared, repositioned via JS) -->
<div class="picker-popup" id="picker">
  <div class="picker-clear" id="picker-clear" title="Remove sticker">‚úï</div>
</div>

<!-- CELL TOOLTIP -->
<div id="cell-tooltip"></div>

<!-- MASTHEAD -->
<div class="masthead">
  <div class="masthead-left">
    <div class="level-chip">‚≠ê Beginner Board</div>
    <div class="title-group">
      <h1 class="main-title">Stronger <em>in 30</em></h1>
    </div>
  </div>
  <div class="masthead-right">
    <div class="date-range"><strong>23 Feb</strong> ‚Äî <strong>24 Mar 2026</strong></div>
    <div class="member-count" id="member-count-display">15 <span>Members</span></div>
    <div id="data-status" class="data-status">‚Äî</div>
    <button onclick="fetchAndSeedCheckins()" id="refresh-btn" class="refresh-btn">‚Üª Refresh</button>
  </div>
</div>

<!-- STICKER LEGEND -->
<div class="sticker-legend">
  <div class="legend-label">Class Format</div>
  <div class="legend-items" id="legend-items"></div>
</div>

<!-- BOARD -->
<div class="board-wrap">
  <div class="table-scroll">
    <table id="main-table">
      <thead id="thead"></thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

<!-- FOOTER -->
<div class="board-footer">
  <div class="footer-note">Stickers auto-populated from Google Sheets check-ins ¬∑ Click any cell to manually place or override a sticker</div>
  <div class="footer-logo">Physique 57</div>
</div>

<script>
// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ
const BEGINNERS = [
  { first: "Ileshaa",   last: "Khatau" },
  { first: "Dipali",    last: "Ved" },
  { first: "Sandhya",   last: "Kapoor" },
  { first: "Preeti",    last: "Rajpurohit" },
  { first: "Arha",      last: "Mehta" },
  { first: "Simren",    last: "Shah" },
  { first: "Natasha",   last: "Pratap" },
  { first: "Poonam",    last: "Chandersy" },
  { first: "Shikha",    last: "Sarkar" },
  { first: "Shikha",    last: "Velkar" },
  { first: "Rina",      last: "Deora" },
  { first: "Suhani",    last: "Chowatia" },
  { first: "Krishi",    last: "Shah" },
  { first: "Srinidhi",  last: "Rajesh" },
  { first: "Sharon",    last: "Mittal" },  // moved Sharon to beginner per data
];

// Wait ‚Äî Sharon Mittal is Advanced in source. Let me correct from source data:
// Beginner: Ileshaa Khatau, Dipali Ved, Sandhya Kapoor, Preeti Rajpurohit, Arha Mehta,
//           Simren Shah, Natasha Pratap, Poonam Chandersy, Shikha Sarkar, Shikha Velkar,
//           Rina Deora, Suhani Chowatia, Krishi Shah, Srinidhi Rajesh

const MEMBERS = [
  // ‚îÄ‚îÄ Kemps Corner ‚îÄ‚îÄ
  { first: "Aanshi",   last: "Gupta",         loc: "KC" },
  { first: "Ayesha",   last: "Kalyaniwalla",   loc: "KC" },
  { first: "Dipali",   last: "Ved",            loc: "KC" },
  { first: "Ekta",     last: "Maru",           loc: "KC" },
  { first: "Koslesh",  last: "Roy",            loc: "KC" },
  { first: "Nipuna",   last: "Munshi",         loc: "KC" },
  { first: "Poonam",   last: "Chandersy",      loc: "KC" },
  { first: "Preeti",   last: "Rajpurohit",     loc: "KC" },
  { first: "Rina",     last: "Deora",          loc: "KC" },
  { first: "Sandhya",  last: "Kapoor",         loc: "KC" },
  { first: "Shikha",   last: "Sarkar",         loc: "KC" },
  { first: "Shikha",   last: "Velkar",         loc: "KC" },
  { first: "Simren",   last: "Shah",           loc: "KC" },
  { first: "Suhani",   last: "Chowatia",       loc: "KC" },
  { first: "Yash",     last: "Nahata",         loc: "KC" },
  // ‚îÄ‚îÄ Bandra ‚îÄ‚îÄ
  { first: "Anjana",   last: "Jhaveri",        loc: "Bandra" },
  { first: "Anya",     last: "Jain",           loc: "Bandra" },
  { first: "Archana",  last: "Iyer",           loc: "Bandra" },
  { first: "Juhi",     last: "Pahwa",          loc: "Bandra" },
  { first: "Katyani",  last: "Gupta",          loc: "Bandra" },
  { first: "Kiara",    last: "Unnikrishnan",   loc: "Bandra" },
  { first: "Kunal",    last: "Deshmukh",       loc: "Bandra" },
  { first: "Marsha",   last: "Silgardo",       loc: "Bandra" },
  { first: "Monika",   last: "Chawla",         loc: "Bandra" },
  { first: "Salonee",  last: "Furia",          loc: "Bandra" },
  { first: "Simrrun",  last: "Shah",           loc: "Bandra" },
  { first: "Vidit",    last: "Mehta",          loc: "Bandra" },
  { first: "Yash",     last: "Prasad",         loc: "Bandra" },
  { first: "Yashvi",   last: "Vashi",          loc: "Bandra" },
];

// ‚îÄ‚îÄ STICKER DEFINITIONS ‚îÄ‚îÄ
const STICKERS = [
  { emoji: 'üíô', label: 'Barre 57', abbr: 'B57', color: '#ff6b35' },
  { emoji: 'üö¥üèª‚Äç‚ôÄÔ∏è', label: 'powerCycle', abbr: 'PC', color: '#e63946' },
  { emoji: 'üßòüèª‚Äç‚ôÄÔ∏è', label: 'Mat 57', abbr: 'Mat', color: '#457b9d' },
  { emoji: 'ü´Ä', label: 'Cardio Barre', abbr: 'CB', color: '#f4a261' },
  { emoji: 'üèãÔ∏è', label: 'Strength Lab', abbr: 'LAB', color: '#6d6875' },
  { emoji: 'üîô', label: 'Back Body Blaze', abbr: 'BBB', color: '#2a9d8f' },
  { emoji: 'üî•', label: 'Amped Up', abbr: 'AMP', color: '#e9c46a' },
  { emoji: 'üí™üèª', label: 'FIT', abbr: 'FIT', color: '#264653' },
  { emoji: '‚ù§Ô∏è‚Äçüî•', label: 'HIIT', abbr: 'HIIT', color: '#d62828' },
  { emoji: '‚ù§Ô∏è‚Äçü©π', label: 'Recovery', abbr: 'REC', color: '#9b72cf' },
];
const STICKER_LABEL = Object.fromEntries(STICKERS.map(s => [s.abbr, { emoji: s.emoji, label: s.label }]));

// ‚îÄ‚îÄ WEEKLY REQUIREMENTS (Beginner) ‚Äî same for both locations ‚îÄ‚îÄ
const WEEKLY_REQUIREMENTS_KC = {
  1: { 'B57': 4, 'PC': 1 },
  2: { 'B57': 3, 'Mat': 1, 'PC': 1 },
  3: { 'B57': 1, 'CB': 1, 'PC': 2, 'Mat': 1 },
  4: { 'CB': 3, 'PC': 1, 'Mat': 1 }
};
const WEEKLY_REQUIREMENTS_BANDRA = WEEKLY_REQUIREMENTS_KC; // Beginner: identical at both locations

// ‚îÄ‚îÄ DAY GENERATION ‚îÄ‚îÄ
const days = [];
const DAYS_SHORT = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
const start = new Date(2026, 1, 23); // Feb 23 2026
for (let i = 0; i < 30; i++) {
  const d = new Date(start);
  d.setDate(start.getDate() + i);
  const dow = d.getDay();
  days.push({
    num: d.getDate(),
    mon: d.toLocaleString('default', { month: 'short' }),
    dayName: DAYS_SHORT[dow],
    isWeekend: dow === 0 || dow === 6,
    key: `${d.getFullYear()}-${d.getMonth()}-${d.getDate()}`,
    fullDate: d
  });
}

// Group into weeks
const weeks = [];
let wk = [];
days.forEach((d, i) => {
  wk.push({ ...d, dayIdx: i });
  if (d.isWeekend && d.dayName === 'Sun') { weeks.push(wk); wk = []; }
});
// Group Mon-Sun chunks of 7
const weekChunks = [];
for (let i = 0; i < days.length; i += 7) {
  weekChunks.push(days.slice(i, i + 7));
}
// Adjust: group by natural weeks (Mon-Sun or just every 7)
const WEEK_COLORS = ['#2d5a27','#1a4d6e','#a05c2d','#6b3fa0','#c0392b'];

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
// state[memberIdx][dayKey] = stickerEmoji or null
const state = MEMBERS.map(() => ({}));

// ‚îÄ‚îÄ PICKER LOGIC ‚îÄ‚îÄ
const picker = document.getElementById('picker');
let activeSlot = null;

// Build picker buttons
STICKERS.forEach(s => {
  const btn = document.createElement('div');
  btn.className = 'picker-sticker';
  btn.textContent = s.emoji;
  btn.title = s.label;
  btn.addEventListener('click', () => {
    if (activeSlot) {
      const { mi, dk } = activeSlot;
      state[mi][dk] = s.emoji;
      refreshBoard();
    }
    closePicker();
  });
  picker.appendChild(btn);
});

document.getElementById('picker-clear').addEventListener('click', () => {
  if (activeSlot) {
    const { mi, dk } = activeSlot;
    delete state[mi][dk];
    refreshBoard();
  }
  closePicker();
});

function openPicker(slot, mi, dk, rect) {
  activeSlot = { mi, dk };
  picker.classList.add('open');
  // Position
  const pw = 186, ph = 140;
  let left = rect.left + rect.width / 2 - pw / 2;
  let top = rect.bottom + 6;
  if (left + pw > window.innerWidth - 8) left = window.innerWidth - pw - 8;
  if (left < 8) left = 8;
  if (top + ph > window.innerHeight - 8) top = rect.top - ph - 6;
  picker.style.left = left + 'px';
  picker.style.top = top + 'px';
}

function closePicker() {
  picker.classList.remove('open');
  activeSlot = null;
}

document.addEventListener('click', (e) => {
  if (!picker.contains(e.target) && !e.target.closest('.sticker-slot')) closePicker();
});

// ‚îÄ‚îÄ CELL TOOLTIP ‚îÄ‚îÄ
const cellTooltip = document.getElementById('cell-tooltip');
function showCellTooltip(text, anchorEl) {
  if (!text) return;
  cellTooltip.textContent = text;
  cellTooltip.style.display = 'block';
  const r = anchorEl.getBoundingClientRect();
  cellTooltip.style.left = (r.left + r.width / 2) + 'px';
  cellTooltip.style.top  = (r.top - 28) + 'px';
}
function hideCellTooltip() {
  cellTooltip.style.display = 'none';
}

// ‚îÄ‚îÄ RENDER LEGEND ‚îÄ‚îÄ
function renderLegend() {
  const el = document.getElementById('legend-items');
  el.innerHTML = '';
  STICKERS.forEach(s => {
    const item = document.createElement('div');
    item.className = 'legend-item';
    item.innerHTML = `<div class="sticker-preview">${s.emoji}</div>${s.label}`;
    el.appendChild(item);
  });
}

// ‚îÄ‚îÄ SCORE & SORT ‚îÄ‚îÄ
function getStickerAbbr(emoji) {
  const sticker = STICKERS.find(s => s.emoji === emoji);
  return sticker ? sticker.abbr : null;
}

// ‚îÄ‚îÄ CLASS EQUIVALENCY GROUPS ‚îÄ‚îÄ
// Classes within a group are interchangeable when checking weekly requirements.
// Group A: Strength-type  (FIT ‚Üî LAB)
// Group B: Cardio-type    (CB ‚Üî BBB ‚Üî CBP ‚Üî HIIT ‚Üî PC)
const EQUIV_GROUPS = [
  new Set(['FIT', 'LAB']),
  new Set(['CB',  'BBB', 'CBP', 'HIIT', 'PC']),
];

function getEquivCount(counts, abbr) {
  const group = EQUIV_GROUPS.find(g => g.has(abbr));
  if (!group) return counts[abbr] || 0;
  let total = 0;
  group.forEach(a => { total += (counts[a] || 0); });
  return total;
}

// Returns true if the given sticker abbr counts toward any requirement in weekNum for a given location
function isStickerQualifying(abbr, weekNum, loc) {
  const reqs = (loc === 'Bandra') ? WEEKLY_REQUIREMENTS_BANDRA : WEEKLY_REQUIREMENTS_KC;
  const requirements = reqs[weekNum];
  if (!requirements || !abbr) return false;
  return Object.keys(requirements).some(reqAbbr => {
    if (reqAbbr === abbr) return true;
    return EQUIV_GROUPS.some(g => g.has(reqAbbr) && g.has(abbr));
  });
}

function getWeekScore(mi, weekNum) {
  const weekIdx = weekNum - 1;
  const weekDays = weekChunks[weekIdx];
  if (!weekDays) return { completed: false, counts: {} };

  const loc = MEMBERS[mi] ? MEMBERS[mi].loc : 'KC';
  const reqs = (loc === 'Bandra') ? WEEKLY_REQUIREMENTS_BANDRA : WEEKLY_REQUIREMENTS_KC;
  const requirements = reqs[weekNum];
  if (!requirements) return { completed: false, counts: {} };

  // Count stickers for this week
  const counts = {};
  weekDays.forEach(day => {
    const emoji = state[mi][day.key];
    if (emoji) {
      const abbr = getStickerAbbr(emoji);
      if (abbr) {
        counts[abbr] = (counts[abbr] || 0) + 1;
      }
    }
  });

  // Check if requirements met (respecting equivalency groups)
  let completed = true;
  for (const [classType, required] of Object.entries(requirements)) {
    if (getEquivCount(counts, classType) < required) {
      completed = false;
      break;
    }
  }

  return { completed, counts, requirements };
}

function getScore(mi) {
  let score = 0;
  for (let week = 1; week <= 4; week++) {
    const { completed } = getWeekScore(mi, week);
    if (completed) score++;
  }
  return score;
}

function getStreak(mi) {
  let streak = 0;
  for (let i = days.length - 1; i >= 0; i--) {
    if (state[mi][days[i].key]) streak++;
    else break;
  }
  return streak;
}

function getTotalClasses(mi) {
  return days.reduce((sum, d) => sum + (state[mi][d.key] ? 1 : 0), 0);
}

function reqToStr(req) {
  return Object.entries(req).map(([cls, n]) => `${n}√ó${cls}`).join(' ¬∑ ');
}

// ‚îÄ‚îÄ BUILD / REFRESH TABLE ‚îÄ‚îÄ
function refreshBoard() {
  // Update member count dynamically
  const countEl = document.getElementById('member-count-display');
  if (countEl) countEl.innerHTML = `${MEMBERS.length} <span>Members</span>`;

  // Group by location, sort by completed weeks desc, then total classes desc
  const allWithScores = MEMBERS.map((m, i) => ({ ...m, mi: i, score: getScore(i), streak: getStreak(i), total: getTotalClasses(i) }));
  const kcSorted     = allWithScores.filter(m => m.loc === 'KC').sort((a, b) => b.score - a.score || b.total - a.total || a.first.localeCompare(b.first));
  const bandraSorted = allWithScores.filter(m => m.loc === 'Bandra').sort((a, b) => b.score - a.score || b.total - a.total || a.first.localeCompare(b.first));

  const thead = document.getElementById('thead');
  const tbody = document.getElementById('tbody');

  // ‚îÄ‚îÄ THEAD ‚îÄ‚îÄ
  thead.innerHTML = '';

  // Week header row
  const weekRow = document.createElement('tr');
  weekRow.className = 'week-header-row';

  // Empty cells for rank and name columns
  const weekRankTh = document.createElement('th');
  weekRankTh.className = 'rank-h';
  weekRow.appendChild(weekRankTh);

  const weekNameTh = document.createElement('th');
  weekNameTh.className = 'name-h';
  weekRow.appendChild(weekNameTh);

  // Week headers spanning their days
  weekChunks.slice(0, 4).forEach((chunk, wi) => {
    const wColor = WEEK_COLORS[wi % WEEK_COLORS.length];
    const wFirst = chunk[0];
    const wLast = chunk[chunk.length - 1];
    const wDateStr = `${wFirst.mon} ${wFirst.num} ‚Äì ${wLast.mon} ${wLast.num}`;

    const weekTh = document.createElement('th');
    weekTh.className = 'week-h';
    weekTh.colSpan = chunk.length;
    weekTh.style.setProperty('--wk-color', wColor);
    weekTh.innerHTML = `
      <div class="week-group-header">
        <div class="week-tag">Week ${wi + 1}</div>
        <div class="week-dates">${wDateStr}</div>
      </div>
    `;
    weekRow.appendChild(weekTh);
  });

  // Bonus days header (if there are more than 28 days)
  if (days.length > 28) {
    const bonusDays = days.slice(28);
    const bonusFirst = bonusDays[0];
    const bonusLast = bonusDays[bonusDays.length - 1];
    const bonusDateStr = `${bonusFirst.mon} ${bonusFirst.num} ‚Äì ${bonusLast.mon} ${bonusLast.num}`;

    const bonusTh = document.createElement('th');
    bonusTh.className = 'week-h bonus-week';
    bonusTh.colSpan = bonusDays.length;
    bonusTh.style.setProperty('--wk-color', '#888');
    bonusTh.innerHTML = `
      <div class="week-group-header">
        <div class="week-tag">Bonus</div>
        <div class="week-dates">${bonusDateStr}</div>
      </div>
    `;
    weekRow.appendChild(bonusTh);
  }

  // Empty cell for score column
  const weekScoreTh = document.createElement('th');
  weekScoreTh.className = 'score-h';
  weekRow.appendChild(weekScoreTh);

  thead.appendChild(weekRow);

  // Day header row
  const headRow = document.createElement('tr');

  // Rank
  const rankTh = document.createElement('th');
  rankTh.className = 'rank-h';
  headRow.appendChild(rankTh);

  // Name
  const nameTh = document.createElement('th');
  nameTh.className = 'name-h';
  nameTh.innerHTML = `<span class="col-label">Member</span>`;
  headRow.appendChild(nameTh);

  // Days
  days.forEach((d, di) => {
    const th = document.createElement('th');
    th.className = 'day-h' + (d.isWeekend ? ' weekend' : '');
    th.innerHTML = `<span class="day-num">${d.num}</span><span class="day-name">${d.dayName}</span>`;

    // Add week separator border
    const weekIdx = Math.floor(di / 7);
    if (di > 0 && di % 7 === 0) {
      th.style.borderLeft = '2px solid var(--border-strong)';
    }

    headRow.appendChild(th);
  });

  // Score
  const scoreTh = document.createElement('th');
  scoreTh.className = 'score-h';
  scoreTh.innerHTML = `<span class="col-label">Weeks</span>`;
  headRow.appendChild(scoreTh);

  thead.appendChild(headRow);

  // ‚îÄ‚îÄ TBODY ‚îÄ‚îÄ
  tbody.innerHTML = '';

  function renderGroupRows(groupList, groupLabel, loc) {
    // Location separator row ‚Äî one td per week column for alignment
    const sepRow = document.createElement('tr');
    sepRow.className = 'location-group-header';

    // Label spans rank + name columns
    const labelTd = document.createElement('td');
    labelTd.colSpan = 2;
    labelTd.className = 'location-header-cell location-label-cell';
    labelTd.textContent = groupLabel;
    sepRow.appendChild(labelTd);

    const locReqs = (loc === 'Bandra') ? WEEKLY_REQUIREMENTS_BANDRA : WEEKLY_REQUIREMENTS_KC;

    // One td per week chunk (W1‚ÄìW4), aligned to the day columns
    weekChunks.slice(0, 4).forEach((chunk, wi) => {
      const goalTd = document.createElement('td');
      goalTd.colSpan = chunk.length;
      goalTd.className = 'location-header-cell location-goal-cell';
      const wn = wi + 1;
      const pills = Object.entries(locReqs[wn]).map(([cls, n]) => {
        const info = STICKER_LABEL[cls] || { emoji: '', label: cls };
        return `<span class="loc-req-pill"><em class="loc-req-count">${n}√ó</em><span class="loc-req-icon">${info.emoji}</span><span class="loc-req-name">${info.label}</span></span>`;
      }).join('');
      goalTd.innerHTML = `<div class="loc-goal-wrap"><span class="loc-span-arrow loc-arrow-l">‚óÑ</span><button class="loc-goal-badge" onclick="this.classList.toggle('open')"><span class="loc-badge-label">Week¬†${wn}</span><div class="loc-badge-detail">${pills}</div></button><span class="loc-span-arrow loc-arrow-r">‚ñ∫</span></div>`;
      sepRow.appendChild(goalTd);
    });

    // Bonus days td (if applicable)
    if (days.length > 28) {
      const bonusTd = document.createElement('td');
      bonusTd.colSpan = days.length - 28;
      bonusTd.className = 'location-header-cell';
      sepRow.appendChild(bonusTd);
    }

    // Score column td
    const scoreTd = document.createElement('td');
    scoreTd.className = 'location-header-cell';
    sepRow.appendChild(scoreTd);

    tbody.appendChild(sepRow);

    groupList.forEach((m, rank) => {
      const animDelay = rank * 0.04;
      const row = document.createElement('tr');
      row.className = 'data-row';
      row.style.animationDelay = animDelay + 's';

      // Rank cell
      const rankTd = document.createElement('td');
      rankTd.className = 'rank-td';
      const rankClass = '';
      const rankDisplay = rank + 1;
      rankTd.innerHTML = `<div class="rank-inner ${rankClass}">${rankDisplay}</div>`;
      row.appendChild(rankTd);

      // Name cell
      const nameTd = document.createElement('td');
      nameTd.className = 'name-td';
      const streakHtml = m.streak >= 3
        ? `<span class="streak-flame show">üî• ${m.streak}</span>`
        : `<span class="streak-flame"></span>`;
      nameTd.innerHTML = `
        <div class="member-name">${m.first} ${m.last}</div>
        <div class="member-sub">${streakHtml}</div>
      `;
      row.appendChild(nameTd);

      // Day cells
      days.forEach((d, di) => {
        const td = document.createElement('td');

        // Determine which week this day belongs to (1-4)
        const weekNum = Math.floor(di / 7) + 1;
        const isCompletedWeek = weekNum <= 4 && getWeekScore(m.mi, weekNum).completed;

        td.className = 'day-td' + (d.isWeekend ? ' weekend' : '') + (isCompletedWeek ? ' week-completed' : '');

        // Add week separator border
        if (di > 0 && di % 7 === 0) {
          td.style.borderLeft = '2px solid var(--border-strong)';
        }

        const stickerVal  = state[m.mi][d.key];
        const stickerAbbr  = stickerVal ? getStickerAbbr(stickerVal) : null;
        const stickerLabel = stickerVal ? (STICKERS.find(s => s.emoji === stickerVal)?.label || '') : '';
        const qualifying   = !!stickerAbbr && weekNum >= 1 && weekNum <= 4 && isStickerQualifying(stickerAbbr, weekNum, m.loc);
        const slot = document.createElement('div');
        slot.className = 'sticker-slot' + (stickerVal ? ' has-sticker' : '') + (qualifying ? ' qualifying' : '');
        slot.textContent = stickerVal || '';
        slot.dataset.mi = m.mi;
        slot.dataset.dk = d.key;
        if (stickerLabel) slot.dataset.label = stickerLabel;

        slot.addEventListener('mouseenter', () => { if (stickerLabel) showCellTooltip(stickerLabel, slot); });
        slot.addEventListener('mouseleave', hideCellTooltip);

        slot.addEventListener('click', (e) => {
          e.stopPropagation();
          const rect = slot.getBoundingClientRect();
          openPicker(slot, m.mi, d.key, rect);
        });

        td.appendChild(slot);
        row.appendChild(td);
      });

      // Score cell
      const scoreTd = document.createElement('td');
      scoreTd.className = 'score-td';
      const sc = m.score;
      const pillClass = sc === 0 ? '' : sc >= 4 ? ' maxed' : ' lit';

      // Build weekly status for tooltip
      let tooltipHTML = '<div class="weekly-status">';
      for (let week = 1; week <= 4; week++) {
        const { completed } = getWeekScore(m.mi, week);
        const badgeClass = completed ? ' complete' : '';
        const icon = completed ? '‚úì' : '‚óã';
        tooltipHTML += `<div class="week-badge${badgeClass}">W${week} ${icon}</div>`;
      }
      tooltipHTML += '</div>';

      scoreTd.innerHTML = `
        <div class="score-pill${pillClass}">
          ${sc}/4
          <div class="score-tooltip">${tooltipHTML}</div>
        </div>
      `;
      row.appendChild(scoreTd);

      tbody.appendChild(row);
    });
  }

  renderGroupRows(kcSorted, 'üìç  Kemps Corner', 'KC');
  renderGroupRows(bandraSorted, 'üìç  Supreme HQ, Bandra', 'Bandra');
}

// ‚îÄ‚îÄ GOOGLE SHEETS CONFIG ‚îÄ‚îÄ
// Configuration loaded from external config.live.js file
const GSHEET_SPREADSHEET_ID = window.GOOGLE_SHEETS_CONFIG.SPREADSHEET_ID;
const GSHEET_SHEET_NAME     = window.GOOGLE_SHEETS_CONFIG.SHEET_NAME;
const OAUTH_CLIENT_ID       = window.GOOGLE_SHEETS_CONFIG.CLIENT_ID;
const OAUTH_CLIENT_SECRET   = window.GOOGLE_SHEETS_CONFIG.CLIENT_SECRET;
const OAUTH_REFRESH_TOKEN   = window.GOOGLE_SHEETS_CONFIG.REFRESH_TOKEN;

// Challenge start date (inclusive)
const CHALLENGE_START = new Date(2026, 1, 23); // Feb 23 2026

// Map 'Cleaned Class' column value ‚Üí sticker emoji
function cleanedClassToEmoji(cleanedClass) {
  const c = (cleanedClass || '').toLowerCase();
  if (/barre 57|studio barre/.test(c))           return '\u{1F499}'; // üíô B57
  if (/powercycle|power cycle|cycle/.test(c))    return '\u{1F6B4}\u{1F3FB}\u{200D}\u{2640}\u{FE0F}'; // üö¥üèª‚Äç‚ôÄÔ∏è PC
  if (/mat 57|mat57/.test(c))                    return '\u{1F9D8}\u{1F3FB}\u{200D}\u{2640}\u{FE0F}'; // üßòüèª‚Äç‚ôÄÔ∏è Mat
  if (/cardio barre/.test(c))                    return '\u{1FAC0}'; // ü´Ä CB
  if (/strength lab|studio lab/.test(c))         return '\u{1F3CB}\u{FE0F}'; // üèãÔ∏è LAB
  if (/back body blaze/.test(c))                 return '\u{1F519}'; // üîô BBB
  if (/amped up/.test(c))                        return '\u{1F525}'; // üî• AMP
  if (/\bfit\b/.test(c))                         return '\u{1F4AA}\u{1F3FB}'; // üí™üèª FIT
  if (/hiit/.test(c))                            return '\u{2764}\u{FE0F}\u{200D}\u{1F525}'; // ‚ù§Ô∏è‚Äçüî• HIIT
  if (/recovery/.test(c))                        return '\u{2764}\u{FE0F}\u{200D}\u{1FA79}'; // ‚ù§Ô∏è‚Äçü©π REC
  return null;
}

function normalizeName(s) {
  return (s || '').trim().toLowerCase().replace(/\s+/g, ' ');
}

async function getAccessToken() {
  // Check if credentials are properly configured
  if (!OAUTH_CLIENT_ID || OAUTH_CLIENT_ID === 'YOUR_CLIENT_ID_HERE' ||
      !OAUTH_CLIENT_SECRET || OAUTH_CLIENT_SECRET === 'YOUR_CLIENT_SECRET_HERE' ||
      !OAUTH_REFRESH_TOKEN || OAUTH_REFRESH_TOKEN === 'YOUR_REFRESH_TOKEN_HERE') {
    throw new Error('Google Sheets integration not configured. Please update GOOGLE_SHEETS_CONFIG with your credentials.');
  }

  const resp = await fetch('https://oauth2.googleapis.com/token', {
    method: 'POST',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: new URLSearchParams({
      client_id:     OAUTH_CLIENT_ID,
      client_secret: OAUTH_CLIENT_SECRET,
      refresh_token: OAUTH_REFRESH_TOKEN,
      grant_type:    'refresh_token',
    })
  });
  if (!resp.ok) {
    const err = await resp.json().catch(() => ({}));
    throw new Error('Token refresh failed: ' + (err.error_description || resp.status));
  }
  const data = await resp.json();
  return data.access_token;
}

async function fetchSheetRows(accessToken) {
  const range = encodeURIComponent(GSHEET_SHEET_NAME + '!A:Z');
  const url   = `https://sheets.googleapis.com/v4/spreadsheets/${GSHEET_SPREADSHEET_ID}/values/${range}`;
  const resp  = await fetch(url, { headers: { Authorization: 'Bearer ' + accessToken } });
  if (!resp.ok) {
    const err = await resp.json().catch(() => ({}));
    throw new Error('Sheets fetch failed: ' + ((err.error && err.error.message) || resp.status));
  }
  const data = await resp.json();
  return data.values || [];
}

async function fetchAndSeedCheckins() {
  const statusEl = document.getElementById('data-status');
  const btn      = document.getElementById('refresh-btn');
  if (statusEl) statusEl.textContent = 'Fetching data‚Ä¶';
  if (btn)      btn.disabled = true;

  try {
    const accessToken = await getAccessToken();
    const rows        = await fetchSheetRows(accessToken);

    if (rows.length < 2) {
      if (statusEl) statusEl.textContent = 'No data found in sheet.';
      return;
    }

    // Parse header row
    const headers    = rows[0].map(h => h.trim());
    const col        = name => headers.indexOf(name);
    const iFirst     = col('First Name');
    const iLast      = col('Last Name');
    const iCheckedIn = col('Checked In');
    const iDate      = col('Date (IST)');
    const iClass     = col('Cleaned Class');

    // Clear existing state for all members
    MEMBERS.forEach((_, mi) => {
      Object.keys(state[mi]).forEach(k => delete state[mi][k]);
    });

    let matched = 0;

    rows.slice(1).forEach(row => {
      // Must be checked in
      if ((row[iCheckedIn] || '').trim().toUpperCase() !== 'TRUE') return;

      // Must be on or after challenge start
      const dateStr = (row[iDate] || '').trim();        // e.g. "2026-02-23"
      const rowDate = new Date(dateStr + 'T00:00:00');
      if (isNaN(rowDate.getTime()) || rowDate < CHALLENGE_START) return;

      // Map class name to emoji
      const emoji = cleanedClassToEmoji((row[iClass] || '').trim());
      if (!emoji) return;

      // Match member by first + last name
      const fullName = normalizeName((row[iFirst] || '') + ' ' + (row[iLast] || ''));
      const mi       = MEMBERS.findIndex(m => normalizeName(m.first + ' ' + m.last) === fullName);
      if (mi === -1) return;

      // Build day key: `year-monthIndex-date`  (same format as days[] key)
      const dk = `${rowDate.getFullYear()}-${rowDate.getMonth()}-${rowDate.getDate()}`;
      if (!days.find(d => d.key === dk)) return;

      // First class of the day wins; subsequent classes on same day are ignored
      if (!state[mi][dk]) {
        state[mi][dk] = emoji;
        matched++;
      }
    });

    refreshBoard();

    const now     = new Date();
    const timeStr = now.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });
    if (statusEl) statusEl.textContent = `\u2713 ${matched} check-in(s) loaded \u00B7 ${timeStr}`;
  } catch (err) {
    console.error(err);
    if (statusEl) {
      if (err.message.includes('not configured') || err.message.includes('not found')) {
        statusEl.textContent = '‚ö† Google Sheets not configured ¬∑ Using manual mode';
        // Load sample data for demonstration
        loadSampleData();
      } else {
        statusEl.textContent = '‚úó ' + err.message;
      }
    }
  } finally {
    if (btn) btn.disabled = false;
  }
}

// Load sample data when Google Sheets is not configured
function loadSampleData() {
  // Clear existing state
  MEMBERS.forEach((_, mi) => {
    Object.keys(state[mi]).forEach(k => delete state[mi][k]);
  });

  // Sample check-ins for demonstration (Beginner level activities)
  const sampleData = [
    // Week 1 samples
    { memberIndex: 0, day: 0, emoji: 'üíô' },   // Member 1 - Barre 57
    { memberIndex: 0, day: 2, emoji: 'üßòüèª‚Äç‚ôÄÔ∏è' }, // Member 1 - Mat 57
    { memberIndex: 1, day: 1, emoji: 'üíô' },   // Member 2 - Barre 57
    { memberIndex: 1, day: 3, emoji: 'üö¥üèª‚Äç‚ôÄÔ∏è' }, // Member 2 - PowerCycle
    { memberIndex: 2, day: 0, emoji: 'üßòüèª‚Äç‚ôÄÔ∏è' }, // Member 3 - Mat 57
    { memberIndex: 2, day: 4, emoji: 'üíô' },   // Member 3 - Barre 57
    { memberIndex: 3, day: 1, emoji: '‚ù§Ô∏è‚Äçü©π' },  // Member 4 - Recovery
    { memberIndex: 4, day: 2, emoji: 'üíô' },   // Member 5 - Barre 57
    
    // Week 2 samples
    { memberIndex: 0, day: 7, emoji: 'üíô' },   // Member 1 - Barre 57
    { memberIndex: 0, day: 9, emoji: 'üßòüèª‚Äç‚ôÄÔ∏è' }, // Member 1 - Mat 57
    { memberIndex: 1, day: 8, emoji: 'üö¥üèª‚Äç‚ôÄÔ∏è' }, // Member 2 - PowerCycle
    { memberIndex: 1, day: 10, emoji: 'üíô' },  // Member 2 - Barre 57
    { memberIndex: 2, day: 7, emoji: '‚ù§Ô∏è‚Äçü©π' },  // Member 3 - Recovery
    { memberIndex: 2, day: 11, emoji: 'üßòüèª‚Äç‚ôÄÔ∏è' }, // Member 3 - Mat 57
    { memberIndex: 3, day: 8, emoji: 'üíô' },   // Member 4 - Barre 57
    { memberIndex: 4, day: 9, emoji: 'üö¥üèª‚Äç‚ôÄÔ∏è' }, // Member 5 - PowerCycle
  ];

  // Apply sample data
  sampleData.forEach(({ memberIndex, day, emoji }) => {
    if (days[day] && MEMBERS[memberIndex]) {
      state[memberIndex][days[day].key] = emoji;
    }
  });

  // Refresh the board to show sample data
  refreshBoard();
  console.log('Loaded sample data for demonstration');
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
renderLegend();
refreshBoard();
fetchAndSeedCheckins();
</script>
</body>
</html>
